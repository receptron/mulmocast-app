# MulmoCast App テストガイド

このディレクトリには MulmoCast Electron アプリの Playwright テストが含まれています。

## テストファイル
* `automated_`: Electron アプリ未起動時に実行するものです。GitHub Actions 向けにも利用します。
* `manual_`: ローカル環境かつElectron アプリ起動時に実行するものです。手動テストの効率化に利用するものも含まれています。

### `automated_`
1. `test/automated_serial_generation_e2e_test.ts` 
**テスト内容:**

- Electronアプリを自動起動・終了
- GitHub ActionsなどのCI/CD環境での使用を想定
- 複数のJSONファイルを使用してプロジェクト作成とコンテンツ生成をテスト
  1. 複数のテストJSONファイル（test_no_audio.json等）で新規プロジェクト作成
  2. JSONエディタでのファイル編集（タイトル変更、パス修正、beat削除）  
      mulmocast-cli のテストファイルを流用しているため、コンテンツファイルのパス変更、 beat 削除等を行なっています
  3. コンテンツ生成の実行と完了待機
  4. 生成されたコンテンツの再生テスト
- 注意
  - 並列してコンテンツ生成を行うと高負荷になり、GitHub Actions でエラーになる。そのため、コンテンツ生成完了してから次のテストファイルを実行するようにしております。

**使用方法:**
```bash
# TypeScriptファイルを直接実行
npx ts-node test/automated_serial_generation_e2e_test.ts
```

### `manual_`
2. `test/manual_run_switch_language.ts`
**言語切り替え**
※ setting がモーダルになったため、手順の見直しが必要

- アプリケーションの表示言語を切り替えるテスト
- 設定画面へのナビゲーションと言語変更を自動化
- 元のページへの自動復帰機能付き

**使用方法:**
```bash
# 日本語に変更
npx tsx test/manual_run_switch_language.ts ja

# 英語に変更
npx tsx test/manual_run_switch_language.ts en
```

**テストフロー:**
1. 現在のページURLを記憶
2. ハンバーガーメニューを開く
3. 設定画面へ移動
4. 言語ドロップダウンから指定言語を選択
5. 言語変更を確認
6. 元のページへ自動で戻る

## 前提条件

### 1. 依存関係のインストール
```bash
yarn install
```

### 2. Playwright の設定
- `playwright` パッケージがインストール済み
- `src/main/main.ts` で開発環境でのCDP有効化済み

### 3. 環境設定
開発環境でのみCDPポートが有効化されるよう設定済み:
```typescript
// src/main/main.ts
if (isDev) {
  app.commandLine.appendSwitch("remote-debugging-port", "9222");
}
```

## data-testid 命名規則

E2Eテストの安定性を確保するため、以下の命名規則に従って`data-testid`属性を設定してください。

### 基本的な命名パターン

1. **ボタン**: `{action}-button`
   - 例: `data-testid="menu-button"`
   - 例: `data-testid="submit-button"`
   - 例: `data-testid="cancel-button"`

2. **メニューアイテム**: `menu-item-{name}`
   - 例: `data-testid="menu-item-settings"`
   - 例: `data-testid="menu-item-dashboard"`

3. **セレクト/ドロップダウン**: `{name}-select`
   - 例: `data-testid="language-select"`
   - 例: `data-testid="provider-select"`

4. **セレクトオプション**: `{name}-option-{value}`
   - 例: `data-testid="language-option-ja"`
   - 例: `data-testid="language-option-en"`

5. **入力フィールド**: `{name}-input`
   - 例: `data-testid="title-input"`
   - 例: `data-testid="api-key-input"`

6. **タブ**: `tab-{name}`
   - 例: `data-testid="tab-text"`
   - 例: `data-testid="tab-media"`

### 命名のベストプラクティス

- **小文字とハイフン**: kebab-caseで統一
- **具体的で説明的**: 機能や目的が明確にわかる名前
- **動的な値**: テンプレートリテラルを使用
  ```vue
  :data-testid="`option-${option.id}`"
  ```

### Vueコンポーネントでの実装例

```vue
<!-- 静的なdata-testid -->
<Button data-testid="submit-button" @click="submit">
  Submit
</Button>

<!-- 動的なdata-testid -->
<SelectItem 
  v-for="option in options" 
  :key="option.id"
  :value="option.id"
  :data-testid="`option-${option.id}`"
>
  {{ option.label }}
</SelectItem>
```

## 開発者向けメモ → Generated by Claude Code プレフィックス、テスト内容は要検討。まずは、Playwright x Electron の確認は完了です。

- 新しいテストを追加する場合は適切なファイル名を使用
- CI/CD用テストは `automated_` プレフィックス
- 手動テスト用は `manual_` プレフィックス
- 全てのテストでプロジェクトタイトルにタイムスタンプを使用